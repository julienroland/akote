(function(e){"use strict";function A(e){for(var t=0;t<n.length;t++)n[t].setMap(e)}function O(){A(t)}var t,n=[],r=[],i,s,o,u=[],a=new google.maps.Circle,f=new google.maps.Rectangle,l=[],c=[],h=new RegExp("[,]"),p=new google.maps.Geocoder,d,v=new google.maps.Marker,m=google.maps.geometry.spherical,g=document.getElementById("map"),y;e(function(){b();w();var t={types:["(cities)"],componentRestrictions:{country:"be"}};y=new google.maps.places.Autocomplete(g,t);e("#filtrer").click(function(){var t=document.getElementById("distance").value;if(e.isNumeric(t))var n=t;else var n=0;var r=document.getElementById("map").value;D(r,n)});e("#map").change(function(){var t=document.getElementById("distance").value;if(e.isNumeric(t))var n=t;else var n=0;var r=document.getElementById("map").value;D(r,n)});M()});var b=function(){e.ajax({dataType:"json",url:"dataKot",success:function(e){s=e.data;E(e.data)}})},w=function(){e.ajax({dataType:"json",url:"dataEcole",success:function(e){o=e.data;S(e.data)}})},E=function(e){var t=new google.maps.MarkerImage("http://www.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png");for(var n=0;n<=e.length-1;n++){var r=e[n].lat,i=e[n].lng,s=[r,i];l.push(s);x(Number(l[n][0]),Number(l[n][1]),e[n].adresse,t)}},S=function(e){var t=new google.maps.MarkerImage("http://www.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png");for(var n=0;n<=e.length-1;n++){var r=e[n].lat,i=e[n].lng,s=[r,i];c.push(s);T(Number(c[n][0]),Number(c[n][1]),e[n].nom,t)}},x=function(e,r,s,o){var u=new google.maps.LatLng(e,r);i=new google.maps.Marker({position:u,map:t,animation:google.maps.Animation.DROP,title:s,icon:o});n.push(i)},T=function(e,n,s,o){var u=new google.maps.LatLng(e,n);i=new google.maps.Marker({position:u,map:t,animation:google.maps.Animation.DROP,title:s,icon:o});r.push(i)},N=function(e,n){return{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:t,center:e,radius:n}},C=function(e){return{bounds:e,map:t,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35}},k=function(r,i){u=[];var o=N(r,i);a.setOptions(o);var f=a.getBounds();for(var l=0;l<=s.length-1;l++)if(!f.contains(new google.maps.LatLng(s[l].lat,s[l].lng)))n[l].setMap(null);else{u.push(s[l]);n[l].setMap(t);t.fitBounds(f)}e("#listKot").attr("value",JSON.stringify(u))},L=function(){A(null)},M=function(){var e={disableDefaultUI:!0,scrollwheel:!1,zoom:7,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(50.5,4)};t=new google.maps.Map(document.getElementById("gmap"),e)},_=function(e,n){a&&a.setMap(null);s=Number(n);var r=e,i=m.computeOffset(r,s,0);v.setPosition(r);v.setMap(t);var s=google.maps.geometry.spherical.computeDistanceBetween(r,i),o=N(e,s);a.setOptions(o);k(e,s)},D=function(n,r){var i=Number(r),s={disableDefaultUI:!0,scrollwheel:!1,zoom:8,mapTypeId:google.maps.MapTypeId.HYBRID,center:p.geocode({address:n,region:"BE"},function(n,s){if(s===google.maps.GeocoderStatus.OK){var o=n[0].geometry.location;t.setZoom(14);t.panTo(o);var u=o;e("#coords").attr("value",u);var a=m.computeOffset(o,i,360);v.setPosition(o);v.setMap(t);_(o,r)}else s===google.maps.GeocoderStatus.ZERO_RESULTS?alert("La google map n'a rien trouvé car aucune donnée n'a été entré"):s===google.maps.GeocoderStatus.INVALID_REQUEST&&alert("La google map n'a rien trouvé car la requête est incorrect")})}}}).call(this,jQuery);