(function(e){"use strict";var t,n=[],r=[],i,s,o,u,a=[],f=[],l,c,h=new google.maps.Circle,p=new google.maps.Rectangle,d=[],v=[],m=new RegExp("[,]"),g=new google.maps.Geocoder,y,b=new google.maps.Marker,w=google.maps.geometry.spherical,E=document.getElementById("map"),S;e(function(){e(window).load(function(){e("#rapide input:checked").val()==="ville"?console.log("ville"):e("#rapide input:checked").val()==="ecole"?console.log("ecole"):e("#rapide input:checked").val()==="aucun"&&console.log("tout")});e("#rapide input").on("click",T);N();C();var t={types:["(cities)"],componentRestrictions:{country:"be"}};S=new google.maps.places.Autocomplete(E,t);H()});var x=function(t){e("#filtrer").click(function(){var n=document.getElementById("distance").value;if(e.isNumeric(n))var r=n;else var r=0;var i=document.getElementById("map").value;t==="ville"?j(i,r):t==="ecole"&&M(r);console.log(t)});e("#map").change(function(){var n=document.getElementById("distance").value;if(e.isNumeric(n))var r=n;else var r=0;var i=document.getElementById("map").value;t==="ville"?j(i,r):t==="ecole"&&M(r);T(i,r)})},T=function(t,n){if(e("#rapide input:checked").val()==="ville"){e("label.type").text("Indiquez l'adresse");e("input.type").attr("placeholder","Namur");l="ville"}else if(e("#rapide input:checked").val()==="ecole"){e("label.type").text("Ecole ciblée");e("input.type").attr("placeholder","Haute Ecole de La Province de Liège ou HEPL");l="ecole"}else e("#rapide input:checked").val()==="aucun"&&console.log("tout");x(l)},N=function(){e.ajax({dataType:"json",url:"dataKot",success:function(e){o=e.data;k(e.data)}})},C=function(){e.ajax({dataType:"json",url:"dataEcole",success:function(e){u=e.data;L(e.data)}})},k=function(e){var t=new google.maps.MarkerImage("http://www.google.com/intl/en_us/mapfiles/ms/micons/red-dot.png");for(var n=0;n<=e.length-1;n++){var r=e[n].lat,i=e[n].lng,s=[r,i];d.push(s);A(Number(d[n][0]),Number(d[n][1]),e[n].adresse,t)}},L=function(e){var t=new google.maps.MarkerImage("http://www.google.com/intl/en_us/mapfiles/ms/micons/blue-dot.png");for(var n=0;n<=e.length-1;n++){var r=e[n].lat,i=e[n].lng,s=[r,i];v.push(s);O(Number(v[n][0]),Number(v[n][1]),e[n].nom,t)}},A=function(e,r,s,o){var u=new google.maps.LatLng(e,r);i=new google.maps.Marker({position:u,map:t,animation:google.maps.Animation.DROP,title:s,icon:o});n.push(i)},O=function(e,n,o,u){var a=new google.maps.LatLng(e,n);s=new google.maps.Marker({position:a,map:t,animation:google.maps.Animation.DROP,title:o,icon:u});r.push(i);M()},M=function(){google.maps.event.addListener(s,"click",function(e){console.log(e);console.log(u);t.setZoom(12);t.panTo(s.getPosition());var n=[];for(var r=0;r<=u.length-1;r++){n={latlng:new google.maps.LatLng(u[r].lat,u[r].lng),nom:u[r].nom};f.push(n)}e.latLng.lat===n.lat&&e.latLng.lng===n.lng&&console.log(n);console.log(f)})},_=function(e,n){return{strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35,map:t,center:e,radius:n}},D=function(e){return{bounds:e,map:t,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35}},P=function(r,i){a=[];var s=_(r,i);h.setOptions(s);var u=h.getBounds();for(var f=0;f<=o.length-1;f++)if(!u.contains(new google.maps.LatLng(o[f].lat,o[f].lng)))n[f].setMap(null);else{a.push(o[f]);n[f].setMap(t);t.fitBounds(u)}e("#listKot").attr("value",JSON.stringify(a))},H=function(){var e={disableDefaultUI:!0,scrollwheel:!1,zoom:8,mapTypeId:google.maps.MapTypeId.ROADMAP,center:new google.maps.LatLng(50.5,4)};t=new google.maps.Map(document.getElementById("gmap"),e)},B=function(e,n){h&&h.setMap(null);s=Number(n);var r=e,i=w.computeOffset(r,s,0);b.setPosition(r);b.setMap(t);var s=google.maps.geometry.spherical.computeDistanceBetween(r,i),o=_(e,s);h.setOptions(o);P(e,s)},j=function(n,r){var i=Number(r),s={disableDefaultUI:!0,scrollwheel:!1,zoom:8,mapTypeId:google.maps.MapTypeId.HYBRID,center:g.geocode({address:n,region:"BE"},function(n,s){if(s===google.maps.GeocoderStatus.OK){var o=n[0].geometry.location;t.setZoom(14);t.panTo(o);var u=o;e("#coords").attr("value",u);var a=w.computeOffset(o,i,360);b.setPosition(o);b.setMap(t);B(o,r)}else s===google.maps.GeocoderStatus.ZERO_RESULTS?alert("La google map n'a rien trouvé car aucune donnée n'a été entré"):s===google.maps.GeocoderStatus.INVALID_REQUEST&&alert("La google map n'a rien trouvé car la requête est incorrect")})}}}).call(this,jQuery);